
if(typeof AbortController==='undefined'){loadJs('/modules/abortcontroller-polyfill/dist/abortcontroller-polyfill-only.js');}
window.requestIdleCallback=window.requestIdleCallback||function(cb){const start=Date.now();return setTimeout(function(){cb({didTimeout:false,timeRemaining:function(){return Math.max(0,50-(Date.now()-start));},});},1);};if(!Promise.prototype.finally){Promise.prototype.finally=Promise.prototype.finally||{finally(fn){const onFinally=(value)=>Promise.resolve(fn()).then(()=>value);return this.then((result)=>onFinally(result),(reason)=>onFinally(Promise.reject(reason)));},}.finally;}
function preloadSupported(){const relList=document.createElement('link').relList;return!!(relList&&relList.supports&&relList.supports('preload'));}
function urlSearchParamsToObject(urlSearchParams){if(Object.fromEntries){return Object.fromEntries(urlSearchParams);}
const result={};for(const entry of urlSearchParams.entries()){const[key,value]=entry;result[key]=value;}
return result;}
async function post(url,formData,extra={}){return new Promise((resolve,reject)=>{const params={method:'POST',body:formData,credentials:'include',headers:getFetchHeaders(),};const loadingSelector=extra.hasOwnProperty('target')?extra.target:null;delete extra.target;Object.assign(params,extra);HappycowCommon.startLoading(loadingSelector);fetch(url,params).then((response)=>response.json()).then((result)=>resolve(result)).catch((e)=>reject(e)).finally(()=>{HappycowCommon.stopLoading(loadingSelector);});});}
async function get(url,extra={}){return new Promise((resolve,reject)=>{const params={headers:getFetchHeaders(),credentials:'include',};const loadingSelector=extra.hasOwnProperty('target')?extra.target:null;delete extra.target;Object.assign(params,extra);HappycowCommon.startLoading(loadingSelector);fetch(url,params).then((response)=>response.json()).then((result)=>resolve(result)).catch((e)=>reject(e)).finally(()=>HappycowCommon.stopLoading(loadingSelector));});}
function nodeListsAreEqual(list1,list2){if(list1.length!==list2.length){return false;}
return Array.from(list1).every((node,index)=>node===list2[index]);}
function emptyElement(elemSelector){const target=isElement(elemSelector)?elemSelector:document.querySelector(elemSelector);if(!target)return false;const clonedNode=target.cloneNode(false);target.parentNode.replaceChild(clonedNode,target);return clonedNode;}
function isElement(elem){return elem instanceof Element||elem instanceof HTMLDocument;}
function htmlToElement(html){const template=document.createElement('template');html=html.trim();template.innerHTML=html;return template.content.firstChild;}
function addContent(elemSelector,content){const target=document.querySelector(elemSelector);if(!target)return;target.innerHTML=content;}
function appendContent(elemSelector,content,position='beforeend'){const target=isElement(elemSelector)?elemSelector:document.querySelector(elemSelector);if(!target)return;target.insertAdjacentHTML(position,content);}
function prependContent(elemSelector,content){const div=document.createElement('div');div.innerHTML=content;const target=isElement(elemSelector)?elemSelector:document.querySelector(elemSelector);if(!target)return;target.prepend(div.firstElementChild);}
function dispatchCustomEvent(item,type,values=null){if(!item)return;const event=new CustomEvent(type,{detail:values});item.dispatchEvent(event);}
function deleteElement(elemSelector){const target=isElement(elemSelector)?elemSelector:document.querySelector(elemSelector);if(!target)return;target.parentNode.removeChild(target);}
function addLiveEventListener(event,selector,handler,useCapture=true){const rootElement=document.querySelector('body');rootElement.addEventListener(event,(evt)=>{let targetElement=evt.target;while(targetElement!=null){if(targetElement.matches(selector)){handler.call(targetElement,evt);return;}
targetElement=targetElement.parentElement;}},useCapture);}
function addOnEventListener(event,selector,handler,useCapture=false){const elementsArray=document.querySelectorAll(selector);elementsArray.forEach((elem)=>{elem.addEventListener(event,(e)=>{handler.call(elem,e);},useCapture);});}
function getNextSiblings(el,filter){const siblings=[];while((el=el.nextSibling)){if(!filter||filter(el)){siblings.push(el);}}
return siblings;}
function getPreviousSiblings(el,filter){const siblings=[];while((el=el.previousSibling)){if(!filter||filter(el)){siblings.push(el);}}
return siblings;}
function getSiblings(elem){const siblings=[];let sibling=elem.parentElement.firstElementChild;while(sibling){if(sibling!==elem){siblings.push(sibling);}
sibling=sibling.nextElementSibling;}
return siblings;}
function getNextSibling(elem,selector){let sibling=elem.nextElementSibling;if(!selector)return sibling;while(sibling){if(sibling.matches(selector))return sibling;sibling=sibling.nextElementSibling;}
return false;}
function getPreviousSibling(elem,selector){let sibling=elem.previousElementSibling;if(!selector)return sibling;while(sibling){if(sibling.matches(selector))return sibling;sibling=sibling.previousElementSibling;}
return false;}
function getFetchHeaders(){const headers={};headers['X-Requested-With']='XMLHttpRequest';return headers;}
function debounce(func,wait,immediate){let timeout;return function(){const context=this;const args=arguments;clearTimeout(timeout);timeout=setTimeout(function(){timeout=null;if(!immediate)func.apply(context,args);},wait);if(immediate&&!timeout)func.apply(context,args);};}
function throttle(func,timeFrame){let lastTime=0;return()=>{const now=new Date();if(now-lastTime>=timeFrame){func();lastTime=now;}};}
function capitalize(string){return string.charAt(0).toUpperCase()+string.slice(1);}
function isInViewport(elem){const bounding=elem.getBoundingClientRect();return(bounding.top>=0&&bounding.left>=0&&bounding.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&bounding.right<=(window.innerWidth||document.documentElement.clientWidth));}
function isScrolledIntoView(el,container){const elemLeft=el.getBoundingClientRect().left;const elemRight=el.getBoundingClientRect().right;const containerLeft=container.getBoundingClientRect().left;const containerRight=container.getBoundingClientRect().right;const overhang=5;return containerLeft<elemLeft+overhang&&containerRight>elemRight-overhang;}
function truncate(str,size){if(str.length>size){return str.substring(0,size)+'...';}
return str;}
function autoHeight(elemSelector,maxLength){const target=isElement(elemSelector)?elemSelector:document.querySelector(elemSelector);counter(target,maxLength);const initialHeight=target.offsetHeight;setAutoHeight(target,initialHeight);target.addEventListener('blur',(e)=>{setAutoHeight(e.target,initialHeight);counter(e.target,maxLength);});target.addEventListener('input',(e)=>{setAutoHeight(e.target,initialHeight);counter(e.target,maxLength);});}
function loadMultipleJs(uris,defer=true){const promises=[];uris.forEach((uri)=>{promises.push(loadJs(uri,defer));});return Promise.all(promises);}
function loadJs(uri,defer=true,async=false){return new Promise((resolve,reject)=>{const elems=document.getElementsByTagName('script');const len=Array.from(elems).filter((e)=>{return e.src==uri;}).length;if(len!==0)resolve();const wf=document.createElement('script');const s=document.scripts[0];wf.onload=resolve;wf.onerror=reject;const jsVersion=document.querySelector('#config').dataset.version;if(uri.includes('?')){wf.src=uri+'&js='+jsVersion;}else{wf.src=uri+'?js='+jsVersion;}
wf.defer=defer;wf.async=async;s.parentNode.insertBefore(wf,s);});}
function setAutoHeight(target,initialHeight){target.style.height='auto';target.style.overflowY='hidden';target.style.height=target.scrollHeight>initialHeight?target.scrollHeight+'px':initialHeight+'px';}
function counter(el,maxLength){const counterEl=el.parentElement.querySelector('.counter');if(!counterEl)return;const length=el.value.length;if(length>=maxLength){el.value=el.value.substring(0,maxLength);}
let left=maxLength-length;left=left<0?0:left;counterEl.textContent=left+' characters left';}
function withinOffset(value1,value2,offset){return value1>value2-offset&&value1<value2+offset;}
function wrap(toWrap,wrapper){wrapper=wrapper||document.createElement('div');toWrap.parentNode.appendChild(wrapper);return wrapper.appendChild(toWrap);}
function sanitize(str){const temp=document.createElement('div');temp.textContent=str;return temp.innerHTML;}
function toggleBodyScroll(){document.body.classList.toggle('scroll-off');}
function getNested(obj,...args){return args.reduce((nobj,level)=>nobj&&nobj[level],obj);}
function setViewport(cssVar){let deviceClientHeight=null;const clientHeight=window.innerHeight;if(clientHeight===deviceClientHeight)return;requestAnimationFrame(()=>{document.documentElement.style.setProperty(cssVar,`${clientHeight}px`);deviceClientHeight=clientHeight;});};
var HappycowCarousel=(function(){function init(selector=false,controlClass='invisible'){carousels=document.querySelectorAll('[data-run="carousel"]:not(.initialized)');if(selector){carousels=document.querySelectorAll(selector);}
carousels.forEach(function(carousel,index){setControlVisibility(carousel,controlClass);if(carousel.classList.contains('initialized'))return;preventSwipeOverflow(carousel);const nextControl=carousel.querySelector('.carousel-controls .carousel-control-next');nextControl.addEventListener('click',function(e){next(carousel);});const prevControl=carousel.querySelector('.carousel-controls .carousel-control-prev');prevControl.addEventListener('click',function(e){prev(carousel);});carousel.querySelector('.carousel-scroll').addEventListener('scroll',debounce(function(e){setControlVisibility(carousel,controlClass);}));carousel.classList.add('initialized');});}
function setControlVisibility(carousel,controlClass){requestAnimationFrame(()=>{const carouselScroll=carousel.querySelector('.carousel-scroll');const controls=carousel.querySelector('.carousel-controls');const prevControl=carousel.querySelector('.carousel-controls .carousel-control-prev');const nextControl=carousel.querySelector('.carousel-controls .carousel-control-next');prevControl.classList.remove(controlClass);nextControl.classList.remove(controlClass);if(controls.classList.contains('auto-position')){const sizeElement=carousel.querySelector('.carousel-item');if(sizeElement){nextControl.style.top=sizeElement.offsetHeight/2+'px';prevControl.style.top=sizeElement.offsetHeight/2+'px';}}
if(carouselScroll.scrollLeft==0){prevControl.classList.add(controlClass);}
if(withinOffset(carouselScroll.scrollLeft+carouselScroll.clientWidth,carouselScroll.scrollWidth,2)){nextControl.classList.add(controlClass);}
if(prevControl.classList.contains(controlClass)&&nextControl.classList.contains(controlClass)){controls.classList.add('hidden');return;}
controls.classList.add('md:block');});}
function setScrollToActiveItem(carouselSelector,options){const carousel=isElement(carouselSelector)?carouselSelector:document.querySelector(carouselSelector);carousel.querySelector('.carousel-item.active').scrollIntoView(options);}
function prev(carouselSelector,scrollOptions={behavior:'smooth',block:'nearest',inline:'end'}){const carousel=isElement(carouselSelector)?carouselSelector:document.querySelector(carouselSelector);const carouselScroll=carousel.querySelector('.carousel-scroll');const items=carouselScroll.querySelectorAll('.carousel-item');const itemsArr=Array.from(items);let itemIndex=1;let visibleItem=null;itemsArr.some(function(item){if(isScrolledIntoView(item,carouselScroll)){visibleItem=item;return true;}
return false;});if(!visibleItem){setIndicators(carousel,-1);return;}
const hiddenItem=visibleItem.previousElementSibling;if(hiddenItem){itemIndex=parseInt(hiddenItem.getAttribute('data-index'),10);hiddenItem.scrollIntoView({behavior:'smooth',block:'nearest',inline:'end'});setIndicators(carousel,itemIndex);}}
function next(carouselSelector,scrollOptions={behavior:'smooth',block:'nearest',inline:'end'}){const carousel=isElement(carouselSelector)?carouselSelector:document.querySelector(carouselSelector);const carouselScroll=carousel.querySelector('.carousel-scroll');const items=carouselScroll.querySelectorAll('.carousel-item');const itemsArr=Array.from(items);let itemIndex=0;let visibleItem=null;itemsArr.reverse().some(function(item){if(isScrolledIntoView(item,carouselScroll)){visibleItem=item;return true;}
return false;});if(!visibleItem){setIndicators(carousel,-1);return;}
const hiddenItem=visibleItem.nextElementSibling;if(hiddenItem){itemIndex=parseInt(hiddenItem.getAttribute('data-index'),10);hiddenItem.scrollIntoView({behavior:'smooth',block:'nearest',inline:'end'});setIndicators(carousel,itemIndex);}}
function setIndicators(carousel,carouselItemIndex){if(!carousel||carouselItemIndex===-1)return;const carouselIndicators=carousel.querySelector('.carousel-indicators');if(!carouselIndicators)return;const carouselIndicator=carousel.querySelector(`.carousel-indicator[data-index="${carouselItemIndex}"]`);carouselIndicators.querySelectorAll('.carousel-indicator').forEach((item)=>{item.classList.remove('active');item.classList.add('opacity-50');});if(carouselIndicator){carouselIndicator.classList.add('active');}}
function preventSwipeOverflow(carousel){carousel.addEventListener('wheel',debounce(function(event){const maxX=this.scrollWidth-this.offsetWidth;const maxY=this.scrollHeight-this.offsetHeight;if(this.scrollLeft+event.deltaX<0||this.scrollLeft+event.deltaX>maxX||this.scrollTop+event.deltaY<0||this.scrollTop+event.deltaY>maxY){event.preventDefault();this.scrollLeft=Math.max(0,Math.min(maxX,this.scrollLeft+event.deltaX));this.scrollTop=Math.max(0,Math.min(maxY,this.scrollTop+event.deltaY));}}),{passive:true});}
return{init:init,next:next,prev:prev,setIndicators:setIndicators,setControlVisibility:setControlVisibility,setScrollToActiveItem:setScrollToActiveItem,};})();;
var HappycowDropdown=(function(){let parentClass='';let dropdownClassName='';let dropdownBtnTarget=null;let dropdownMenu=null;let dropdownMenuHeight=null;let dropdownMenuOffset=null;function init(pClass,dClassName){parentClass=pClass;dropdownClassName=dClassName;addLiveEventListener('click',`${parentClass} ${dropdownClassName}`,clickHandler,true);document.addEventListener('click',function(e){if(e.target){if(e.target.classList.contains('dropdown-toggle')||e.target.classList.contains('dropdown-menu')){return;}}
const dropdownBtns=document.querySelectorAll(`${parentClass} .dropdown-menu`);dropdownBtns.forEach(function(item){if(item.parentNode.classList.contains('open')){item.parentNode.classList.remove('open');dispatchCustomEvent(getPreviousSibling(item,`${parentClass} ${dropdownClassName}`),'hidden.hc.dropdown');}});});}
function clickHandler(e){e.stopPropagation();dropdownMenu=this.parentNode.querySelector('.dropdown-menu');if(!dropdownMenu)return;const isVisible=!!(dropdownMenu.offsetWidth||dropdownMenu.offsetHeight||dropdownMenu.getClientRects().length);if(!isVisible){closeOpened();dropdownMenu.parentNode.classList.add('open');document.querySelector('.dropdown.open .dropdown-toggle');dispatchCustomEvent(this,'shown.hc.dropdown');detectCollision(e.target);return;}
dropdownMenu.parentNode.classList.remove('open');dispatchCustomEvent(this,'hidden.hc.dropdown');}
function closeOpened(){const dropdowns=document.querySelectorAll(`${parentClass} .dropdown-menu`);dropdowns.forEach(function(item){if(item.parentNode.classList.contains('open')){item.parentNode.classList.remove('open');}});}
function detectCollision(dropdownTarget){if(!dropdownTarget.getAttribute('data-collision')){return;}
dropdownBtnTarget=dropdownTarget;dropdownMenuHeight=dropdownMenu.getBoundingClientRect().height;dropdownMenuOffset=parseInt(dropdownTarget.getAttribute('data-offset'),10)||100;if(dropdownTarget.getBoundingClientRect().top<dropdownMenuHeight+dropdownMenuOffset){dropdownMenu.classList.add('reverse-position');}else{dropdownMenu.classList.remove('reverse-position');}}
function detectCollisionOnScroll(){window.addEventListener('scroll',debounce(function(){if(dropdownBtnTarget&&dropdownBtnTarget.getAttribute('data-collision')){detectCollision(dropdownBtnTarget);if(window.innerWidth>=768&&dropdownBtnTarget.getBoundingClientRect().top<-dropdownMenuHeight-dropdownMenuOffset){if(dropdownMenu.classList.contains('reverse-position')){dropdownMenu.classList.remove('reverse-position');}
dropdownMenu.parentElement.classList.remove('open');}}},200));}
return{init:init,closeOpened:closeOpened,detectCollisionOnScroll:detectCollisionOnScroll,};})();;
var HappycowGeolocation=(function(){const geolocationTimeout=5000;function getCoordinates(){return new Promise(function(resolve,reject){if(!navigator.permissions){return reject(new Error('Permission API is not supported'));}
navigator.permissions.query({name:'geolocation'}).then(function(permission){if(permission.state==='granted'){return navigator.geolocation.getCurrentPosition(function(position){return resolve(position);},function(error){return reject(new Error(error.message));},{timeout:geolocationTimeout});}
return resolve(null);});});}
function locate(enableHighAccuracy=true){return new Promise(function(resolve,reject){navigator.geolocation.getCurrentPosition(function(position){resolve(position);},function(error){reject(error);},{enableHighAccuracy:enableHighAccuracy,timeout:geolocationTimeout,maximumAge:60000,});});}
return{getCoordinates:getCoordinates,locate:locate,};})();;
var HappycowModal=(function(){const body=document.querySelector('body');function init(){const modalTriggers=document.querySelectorAll('[data-trigger="modal"]:not(.activated)');modalTriggers.forEach(function(item,index){item.classList.add('activated');item.addEventListener('click',function(e){e.preventDefault();const modal=document.querySelector(item.dataset.hcTarget);if(!modal)return;if(!modal.classList.contains('show')){modal.classList.add('show');deleteBackdrop();if(item.getAttribute('data-backdrop-mobile')){appendContent('body','<div class="modal-backdrop in fixed inset-0 bg-black opacity-30 z-40"></div>');}else{appendContent('body','<div class="modal-backdrop in fixed inset-0 bg-black opacity-30 z-40 hidden md:block"></div>');}
dispatchCustomEvent(modal,'shown.hc.modal',e.target);}});});const modalDismiss=document.querySelectorAll('[data-release="modal"]:not(.activated)');modalDismiss.forEach(function(item,index){item.classList.add('activated');item.addEventListener('click',function(e){e.preventDefault();const modal=item.closest('.modal');if(!modal)return;if(modal.classList.contains('show')){modal.classList.remove('show');dispatchCustomEvent(modal,'hidden.hc.modal');}
deleteBackdrop();});});addOnEventListener('click','.modal',function(e){if(this.dataset.block)return;if(e.target!==this)return;if(this.classList.contains('show')){this.classList.remove('show');dispatchCustomEvent(this,'hidden.hc.modal');}
deleteBackdrop();});}
function closeOpened(){close('.modal.show');}
function isOpened(){const opened=document.querySelector('.modal.show');if(opened){return true;}
return false;}
function close(elemSelector){const modals=document.querySelectorAll(elemSelector);if(!modals)return;modals.forEach(function(modal){modal.classList.remove('show');dispatchCustomEvent(modal,'hidden.hc.modal');});deleteBackdrop();}
function deleteBackdrop(){const modals=document.querySelectorAll('.modal.show');if(modals.length==0){body.classList.remove('modal-open');deleteElement('.modal-backdrop');}}
function terminate(elemSelector){const modals=document.querySelectorAll(elemSelector);if(!modals)return;modals.forEach(function(modal){dispatchCustomEvent(modal,'hidden.hc.modal');deleteElement(modal);});deleteBackdrop();}
function show(elemSelector,message='',mobileBackdrop=true,backdropClass=''){const modal=document.querySelector(elemSelector);if(!modal)return;modal.classList.add('show');body.classList.add('modal-open');deleteElement('.modal-backdrop');if(message.length>0){HappycowAlert.alertBox(`${elemSelector} .modal-content`,message);}
if(mobileBackdrop){appendContent('body',`<div class="modal-backdrop in fixed inset-0 bg-black opacity-30 z-40 ${backdropClass}"></div>`);dispatchCustomEvent(modal,'shown.hc.modal');return;}
appendContent('body',`<div class="modal-backdrop in hidden fixed inset-0 bg-black opacity-30 z-40 md:block ${backdropClass}"></div>`);dispatchCustomEvent(modal,'shown.hc.modal');}
return{init:init,show:show,close:close,closeOpened:closeOpened,isOpened:isOpened,delete:terminate,};})();;
var HappycowPubSub=function(){const subscribers={};function publish(eventName,data){if(!Array.isArray(subscribers[eventName])){return;}
subscribers[eventName].forEach((callback)=>{callback(data);});}
function subscribe(eventName,callback){if(!Array.isArray(subscribers[eventName])){subscribers[eventName]=[];}
subscribers[eventName].push(callback);}
return{publish:publish,subscribe:subscribe,};};;
var HappycowCommon=(function(){let userStatus=null;let userTimestamp=null;function isUserStatusValid(){if(!userStatus)return false;const diff=Math.floor((Date.now()-userTimestamp)/1000);return diff<300;}
function initAppleApi(){return new Promise(function(resolve,reject){if(typeof AppleID==='undefined'){loadJs('//appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js').then(function(){const csrf=HappycowCommon.csrf();AppleID.auth.init({clientId:'com.smoothlandon.happycow.website',scope:'name email',redirectURI:'https://www.happycow.net/',state:csrf.value,usePopup:true,});resolve();}).catch(function(e){reject();});return;}
resolve();});}
function initGoogleApi(){return new Promise(function(resolve,reject){if(typeof gapi==='undefined'){loadJs('//apis.google.com/js/api:client.js').then(function(){gapi.load('auth2',function(){auth2=gapi.auth2.init({client_id:'755501293095-br77j34ovtp5cqatla3kvblr3s0vr117.apps.googleusercontent.com',cookiepolicy:'single_host_origin',});resolve();});}).catch(function(e){});return;}
resolve();});}
return{authCheck:function(){return new Promise(function(resolve,reject){HappycowCommon.userData().then(function(result){const csrfEl=document.querySelector('._csrf');if(csrfEl){csrfEl.setAttribute('name',result.data.csrf.key);csrfEl.value=result.data.csrf.token;csrf=HappycowCommon.csrf();}
if(result.data.username){userStatus=result;userTimestamp=Date.now();resolve(result.data);return;}
resolve(false);}).catch(function(e){reject();});});},csrf:function(){const csrfEl=document.querySelector('._csrf');if(!csrfEl)return false;return{name:csrfEl.getAttribute('name'),value:csrfEl.value};},cleanBtnStatus:function(selector){document.querySelectorAll(selector).forEach((item)=>{item.classList.remove('active','selected','bg-primary-500','bg-gray-700','text-white');item.classList.add('text-base-500');});},setBtnStatus:function(elem,danger=false){if(elem.classList.contains('active')){elem.classList.add('text-base-500');elem.classList.remove('active','selected','bg-primary-500','bg-gray-700','text-white');return;}
elem.classList.remove('text-base-500');if(danger){elem.classList.add('active','selected','bg-gray-700','text-white');return;}
elem.classList.add('active','selected','bg-primary-500','text-white');},likeImage:function(imageId){return new Promise(function(resolve,reject){const formData=new FormData();formData.append(csrf.name,csrf.value);post(`/ajax/image/${imageId}/like`,formData,{target:false}).then(function(result){if(result.success){resolve(result);return;}
throw new Error('Something went wrong. Please try again later or contact us.');}).catch(function(error){reject(error);});});},likeUserImage:function(imageId){return new Promise(function(resolve,reject){const formData=new FormData();formData.append(csrf.name,csrf.value);post(`/ajax/user/image/${imageId}/like`,formData,{target:false}).then(function(result){if(result.success){resolve(result);return;}
throw new Error('Something went wrong. Please try again later or contact us.');}).catch(function(error){reject(error);});});},setObserver:function(el){const els=document.querySelectorAll(el);els.forEach(function(item){HappycowObserver.observe(item);});},setImageObserver:function(el){const els=document.querySelectorAll(el);els.forEach(function(item){HappycowObserver.preloadImageObserve(item);});},sendLoginAnalytics:function(prefix){prefix=typeof prefix!=='undefined'?prefix:'hc';HappycowAnalytics.gtagEvent('login',{method:prefix,});},sendRegisterAnalytics:function(prefix){prefix=typeof prefix!=='undefined'?prefix:'hc';HappycowAnalytics.gtagEvent('sign_up',{method:prefix,});},linkify:function(el){linkifyElement(document.querySelector(el),{target:'_blank',attributes:{rel:'nofollow noreferrer noopener',},className:'linkified text-primary-500',});},initGoogleApi:function(){return initGoogleApi();},initAppleApi:function(){return initAppleApi();},userData:function(){return new Promise(function(resolve,reject){if(isUserStatusValid())return resolve(userStatus);const pageUrl=document.body.getAttribute('id');get(`/ajax/user-data?page=${pageUrl}`,{target:false}).then(function(result){if(result.success){userStatus=result;userTimestamp=Date.now();}
resolve(result);}).catch(function(e){reject(e);});});},retypePassword:function(){return new Promise(function(resolve,reject){const message=`<form onsubmit="return false;" class="py-2"><input type="password" class="appearance-none border border-gray-300 rounded w-full py-3 px-3 text-gray-800 placeholder-base-color leading-tight focus:outline-none focus:ring focus:border-input focus:shadow-input" id="check-password" name="check-password" placeholder="Enter your password" size="150" value="" autocomplete="off"></form>`;HappycowAlert.alert({title:'Please type your password to continue',message:message,buttons:{cancel:true,confirm:{text:'Submit',closeModal:false,},},}).then(function(value){if(!value){return;}
value=document.querySelector('.modal-alert input').value;const formData=new FormData();formData.append(csrf.name,csrf.value);formData.append('password',value);HappycowAlert.loading();post('/ajax/login/validate',formData,{target:false}).then(function(data){if(data.success){return resolve();}
return reject(data.message||'Something went wrong. Please try again later or contact us.');}).catch(function(error){return reject('Something went wrong. Please try again later or contact us.');});});});},startLoading:function(targetSelector){if(targetSelector===false)return;const target=document.querySelector(targetSelector);if(target){target.classList.add('opacity-50','cursor-pointer','pointer-events-none');return;}
document.body.classList.add('opacity-50','cursor-pointer','pointer-events-none');},stopLoading:function(targetSelector){if(targetSelector===false)return;const target=document.querySelector(targetSelector);if(target){target.classList.remove('opacity-50','cursor-pointer','pointer-events-none');return;}
document.body.classList.remove('opacity-50','cursor-pointer','pointer-events-none');},};})();;
var HappycowSidebar=(function(){function init(){checkWindowSize();addLiveEventListener('click','#geolocate-user-nearby-btn',function(e){e.preventDefault();errTimeout=setTimeout(onNavbarGeoError,10000);const form=document.querySelector('#location-nearby-form-navbar');HappycowToastr.success('Detecting your location, please wait...');HappycowGeolocation.locate().then(function(position){clearTimeout(errTimeout);form.querySelector('#lat-nearby-navbar').value=position.coords.latitude;form.querySelector('#lng-nearby-navbar').value=position.coords.longitude;HappycowCookies.deleteCookie('hcsearchopts',{path:'/'});form.submit();}).catch(function(){onNavbarGeoError();});});}
function toggleSidebar(){HappycowDropdown.closeOpened();requestAnimationFrame(()=>{document.querySelector('#btn-sidebar').classList.toggle('btn-toggle-active');document.querySelector('.navbar-collapse').classList.toggle('navbar-collapse-open');if(document.querySelector('.navbar-collapse').classList.contains('navbar-collapse-open')){document.body.style.overflowY='auto';deleteElement('#sidebar-content-overlay');appendContent('body',"<div id='sidebar-content-overlay' class='content-overlay fixed left-0 right-0 bottom-0 top-[71px] z-20 bg-black opacity-30'></div>");return;}
deleteElement('#sidebar-content-overlay');});}
function hide(){requestAnimationFrame(()=>{const btnSidebar=document.querySelector('#btn-sidebar');const navbarCollapse=document.querySelector('.navbar-collapse');const contentOverlay=document.querySelector('#sidebar-content-overlay');if(btnSidebar){btnSidebar.classList.remove('btn-toggle-active');}
if(navbarCollapse){navbarCollapse.classList.remove('navbar-collapse-open');}
if(contentOverlay){contentOverlay.remove();}});}
function checkWindowSize(){addLiveEventListener('click','#btn-sidebar',toggleSidebar);if(window.innerWidth<1200){addLiveEventListener('click','body',function(e){onBodyClick(e);});addLiveEventListener('touchstart','body',function(e){onBodyClick(e);});}
window.addEventListener('resize',debounce(function(e){if(e.target.innerWidth>1199){hide();return;}
setSidebarHeight();}),250);}
function setSidebarHeight(){const navbarCollapse=document.querySelector('.navbar-collapse');if(navbarCollapse){navbarCollapse.style.setProperty('--mobile-height',`${window.innerHeight - 71}px`);}}
function onBodyClick(e){if(e.target.classList.contains('content-overlay')){hide();}}
function onNavbarGeoError(){clearTimeout(errTimeout);const form=document.querySelector('#location-nearby-form-navbar');form.querySelector('#lat-nearby-navbar').value=form.dataset.ipLat;form.querySelector('#lng-nearby-navbar').value=form.dataset.ipLng;HappycowCookies.deleteCookie('hcsearchopts',{path:'/'});form.submit();}
return{init:init,hide:hide,};})();;
var HappycowValidator=(function(){let usernameCheckMessage='';let emailCheckMessage='';let controller=null;let emailController=null;const state=[];const allowList=new Set(['www.happycow.net','www.youtube.com','www.youtu.be']);function init(){const validatorChecks=document.querySelectorAll('[data-validator="check"]:not(.activated)');validatorChecks.forEach(function(item,index){item.classList.add('activated');item.addEventListener('keyup',function(e){checkRequired(this,true);});item.addEventListener('change',function(e){checkRequired(this,true);});});}
function clean(form){const formKey=form.id;if(state[formKey]){delete state[formKey];}}
function uid(){return Date.now().toString(36)+Math.random().toString(36).substr(2);}
function checkRequired(form,activeOnly=true,highlight=true){return new Promise(function(resolve,reject){const promises=[];const requiredFields=form.querySelectorAll('[required]');const formKey=form.id;if(!state[formKey])state[formKey]={};requiredFields.forEach(function(item,index){if(item.id.length==0||!item.id){item.id=uid();}
if(!state[formKey][item.id]){state[formKey][item.id]=false;}
if(item==document.activeElement||!activeOnly){promises.push(validate(item,highlight));}});Promise.all(promises).then(function(values){values.forEach((item)=>{state[formKey][item[0].id]=item[1];isValid(form);});resolve(isValid(form));}).catch(function(e){reject(e);});});}
function isValid(form){const formKey=form.id;return Object.keys(state[formKey]).every(function(k){return state[formKey][k]===true;});}
function validate(item,highlight=true){return new Promise(function(resolve,reject){const helpBlock=getHelpBlock(item);isInvalid(item).then(function(validationArr){for(const validation of validationArr){if(validation.invalid){if(highlight)item.classList.add('border-red-500');if(helpBlock&&highlight){helpBlock.innerText=validation.message;}
resolve([item,false]);return;}}
if(highlight)item.classList.remove('border-red-500');if(helpBlock&&highlight){helpBlock.innerText='';}
resolve([item,true]);}).catch(function(e){reject();});});}
function getHelpBlock(item){let helpBlock=getNextSibling(item,'.help-block');if(helpBlock){return helpBlock;}
helpBlock=getNextSibling(item.parentElement,'.help-block');if(helpBlock){return helpBlock;}
const closest=item.closest('.form-group');if(!closest)return;helpBlock=closest.querySelector('.help-block');return helpBlock;}
function isInvalid(item){const minLength=item.dataset.minLength||false;const maxLength=item.dataset.maxLength||false;const email=item.dataset.email||false;const emailCheck=item.dataset.emailCheck||false;const usernameCheck=item.dataset.usernameCheck||false;const contains=item.dataset.contains||false;const emptyOk=item.dataset.empty||false;const checkboxCheck=item.dataset.checkboxCheck||false;let pArr=[validateEmpty(item)];if(emptyOk){pArr=[];}
if(contains){pArr.push(validateContains(item));}
if(email){pArr.push(validateEmail(item));}
if(emailCheck){pArr.push(validateEmailCheck(item));}
if(usernameCheck){pArr.push(validateUsernameCheck(item));}
if(minLength){pArr.push(validateMinLength(item));}
if(maxLength){pArr.push(validateMaxLength(item));}
if(checkboxCheck){pArr.push(validateCheckbox(item));}
return Promise.all(pArr);}
function validateEmpty(item){return new Promise(function(resolve,reject){resolve({invalid:item.value.trim().length==0,message:getErrorMessage(item,99)});});}
function validateCheckbox(item){return new Promise(function(resolve,reject){const invalid=!item.checked;resolve({invalid:invalid,message:getErrorMessage(item,6)});});}
function validateMaxLength(item){return new Promise(function(resolve,reject){const maxLength=item.dataset.maxLength||false;resolve({invalid:item.value.trim().length==0||item.value.trim().length>maxLength,message:getErrorMessage(item,0)});});}
function validateMinLength(item){return new Promise(function(resolve,reject){const minLength=item.dataset.minLength||false;resolve({invalid:item.value.trim().length==0||item.value.trim().length<minLength,message:getErrorMessage(item,1)});});}
function validateUsernameCheck(item){return new Promise(function(resolve,reject){checkUsername(item.value.trim()).then(function(status){resolve({invalid:status,message:getErrorMessage(item,3)});});});}
function validateEmailCheck(item){return new Promise(function(resolve,reject){checkEmail(item.value.trim()).then(function(status){resolve({invalid:status,message:getErrorMessage(item,4)});});});}
function validateEmail(item){return new Promise(function(resolve,reject){const emptyOk=item.dataset.empty||false;let invalid=item.value.trim().length==0||!validateEmailHelper(item.value.trim());if(emptyOk&&item.value.trim().length==0){invalid=false;}
resolve({invalid:invalid,message:getErrorMessage(item,2)});});}
function validateContains(item){return new Promise(function(resolve,reject){const contains=item.dataset.contains||false;if(!contains)resolve({invalid:false,message:getErrorMessage(item,5)});const regex=new RegExp(contains,'i');const invalid=item.value.match(regex)===null;resolve({invalid:invalid,message:getErrorMessage(item,5)});});}
function validateEmailHelper(email){const re=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email);}
function validateURL(textURL){let dataURL={};let currentURL=textURL;let trustedURL=false;if(!currentURL.startsWith('http://')&&!currentURL.startsWith('https://')){currentURL=`https://${currentURL}`;}
try{const baseURL=new URL(currentURL);const host=baseURL.host.split('.');let newURL=baseURL.href;if(baseURL.host.startsWith('www')&&host.length<3){dataURL.valid=false;return dataURL;}
if(host.length<2){dataURL.valid=false;return dataURL;}
if(/(\d+\.\d+.\d+.\d+)/g.test(baseURL.host)||/@/g.test(baseURL)){dataURL.valid=false;return dataURL;}
if(baseURL.port||baseURL.username||baseURL.password){dataURL.valid=false;return dataURL;}
if(baseURL.host.startsWith('www')&&allowList.has(baseURL.host)){trustedURL=true;}
if(!baseURL.host.startsWith('www')&&allowList.has(`www.${baseURL.host}`)){trustedURL=true;}
if(!trustedURL&&baseURL.search){newURL=newURL.split('?')[0];if(baseURL.hash){newURL=`${newURL}${baseURL.hash}`;}}
dataURL={href:baseURL.href,cleanURL:newURL,oldURL:textURL,valid:true,trustedURL:trustedURL,};return dataURL;}catch(err){dataURL.valid=false;return dataURL;}}
async function checkUsername(username){if(controller){controller.abort();controller=null;}
controller=new AbortController();const signal=controller.signal;username=encodeURIComponent(username);try{const response=await get(`/ajax/username/check?username=${username}`,{target:false,signal:signal});if(!response.success){usernameCheckMessage=response.message;return true;}}catch(err){}
return false;}
async function checkEmail(email){if(emailController){emailController.abort();emailController=null;}
emailController=new AbortController();const signal=emailController.signal;email=encodeURIComponent(email);try{const response=await get(`/ajax/email/check?email=${email}`,{target:false,signal:signal});if(!response.success){emailCheckMessage=response.message;return true;}}catch(err){}
return false;}
function getErrorMessage(item,type){const maxLength=item.dataset.maxLength||65000;const minLength=item.dataset.minLength||0;switch(type){case 0:return item.dataset.message||`Maximum of ${maxLength} characters`;case 1:return item.dataset.message||`Minimum of ${minLength} characters`;case 2:return item.dataset.message||'A valid email is required';case 3:return usernameCheckMessage||'This username cannot be used';case 4:return emailCheckMessage||'This email cannot be used';case 5:return item.dataset.containsText||'Required field';case 6:return item.dataset.containsText||'This checkbox is required';default:return item.dataset.message||'Required field';}}
return{init:init,check:checkRequired,isValid:isValid,validateURL:validateURL,clean:clean,};})();;
var HappycowAuthentication=function(){function facebook(){const formData=new FormData();formData.append(csrf.name,csrf.value);return request('/ajax/login/facebook',formData);}
function google(token){const formData=new FormData();formData.append(csrf.name,csrf.value);formData.append('token',token);return request('/ajax/login/google',formData);}
function login(user,password,remember){const formData=new FormData();formData.append(csrf.name,csrf.value);formData.append('username',user);formData.append('password',password);formData.append('remember',remember);return request('/ajax/login',formData);}
function apple(token){const formData=new FormData();formData.append(csrf.name,csrf.value);formData.append('token',token);return request('/ajax/login/apple',formData);}
function request(url,formData){return new Promise(function(resolve,reject){post(url,formData).then(function(data){if(data.success){return resolve(data);}
return resolve(data);}).catch(function(error){return reject('Something went wrong. Please try again later or contact us.');});});}
return{login:login,facebookLogin:facebook,googleLogin:google,appleLogin:apple,};};;
var HappycowMemberNotifications=function(){const mediaBreakpoint=window.matchMedia('(max-width: 1199px)');const notificationsDropdowns=document.querySelectorAll('.navbar-notifications .dropdown');const limit=18;let lastScrollFireTime=0;let lastScrollTop=0;let currentPage=-1;let readAll=true;let scrollTimer=null;let controller=null;function bind(){addOnEventListener('click','#btn-close-user-dropdown',function(){requestAnimationFrame(()=>{if(mediaBreakpoint.matches){document.body.classList.remove('scroll-off');}});});addOnEventListener('click','#btn-hide-message',function(){requestAnimationFrame(()=>{if(mediaBreakpoint.matches){document.body.classList.remove('scroll-off');}});});addOnEventListener('click','#btn-hide-notifications',function(){requestAnimationFrame(()=>{if(mediaBreakpoint.matches){document.body.classList.remove('scroll-off');}});});addLiveEventListener('hidden.hc.dropdown','#btn-open-user-dropdown',function(){requestAnimationFrame(()=>{if(mediaBreakpoint.matches){document.body.classList.remove('scroll-off');}});});addLiveEventListener('hidden.hc.dropdown','#btn-open-notifications',function(){requestAnimationFrame(()=>{if(mediaBreakpoint.matches){document.body.classList.remove('scroll-off');}});readAll=false;});addLiveEventListener('hidden.hc.dropdown','#btn-open-message',function(){requestAnimationFrame(()=>{if(mediaBreakpoint.matches){document.body.classList.remove('scroll-off');}});});addLiveEventListener('shown.hc.dropdown','#btn-open-user-dropdown',function(){HappycowSidebar.hide();requestAnimationFrame(()=>{if(mediaBreakpoint.matches){document.body.classList.add('scroll-off');}});});addLiveEventListener('shown.hc.dropdown','#btn-open-message',function(){HappycowSidebar.hide();requestAnimationFrame(()=>{if(mediaBreakpoint.matches){document.body.classList.add('scroll-off');}});});addLiveEventListener('shown.hc.dropdown','#btn-open-notifications',function(){HappycowSidebar.hide();requestAnimationFrame(()=>{if(mediaBreakpoint.matches){document.body.classList.add('scroll-off');}
if(readAll)markAllRead();readAll=false;});});window.addEventListener('resize',debounce(()=>{if(window.innerWidth<1200){notificationsDropdowns.forEach((dropdown)=>{if(dropdown.classList.contains('open')){document.body.classList.add('scroll-off');}});return;}
notificationsDropdowns.forEach((dropdown)=>{if(dropdown.classList.contains('open')){document.body.classList.remove('scroll-off');}});},250));scrollBind();}
function markAllRead(){const formData=new FormData();post('/ajax/views/members/notifications/read',formData,{target:false}).then(function(d){const badge=document.querySelector('.navbar-notifications .dropdown-notifications .badge-unread-messages');if(badge)badge.remove();});}
function getNotificationSelector(){return window.innerWidth<1200?'.navbar-notifications .dropdown-menu-notifications':'.navbar-notifications .dropdown-notifications .dropdown-content';}
function scrollBind(){const notificationSelector=getNotificationSelector();addOnEventListener('scroll',notificationSelector,function(){const minScrollTime=200;const now=new Date().getTime();function processScroll(){if(controller){return;}
const boxContent=document.querySelector(notificationSelector);const st=(100*boxContent.scrollTop)/(boxContent.scrollHeight-boxContent.clientHeight);if(st>=lastScrollTop){if(st>60){getNotifications();}}
lastScrollTop=st<=0?0:st;}
if(!scrollTimer){if(now-lastScrollFireTime>3*minScrollTime){processScroll();lastScrollFireTime=now;}
scrollTimer=setTimeout(function(){scrollTimer=null;lastScrollFireTime=new Date().getTime();processScroll();},minScrollTime);}});}
function getNotifications(){const offset=document.querySelectorAll('.navbar-notifications .dropdown-notifications .dropdown-content li').length;const page=Math.floor(offset/limit)+1;if(currentPage>=page){return;}
currentPage=page;if(controller)controller.abort();controller=new AbortController();const signal=controller.signal;get(`/ajax/views/members/notifications?offset=${offset}&limit=${limit}`,{signal:signal,target:false}).then(function(d){if(d.success){requestAnimationFrame(()=>{const notificationSelector=getNotificationSelector();appendContent(`${notificationSelector} .dropdown-list`,d.data);HappycowCommon.setObserver('.dropdown-list .lazy-js-image');});return;}
HappycowToastr.error("Sorry, we're not able to load your notifications at the moment. Please try again soon.");}).catch(function(err){if(err.name!=='AbortError'){HappycowToastr.error("Sorry, we're not able to load your notifications at the moment. Please try again soon.");}}).finally(function(){controller=null;});}
function init(){bind();}
return{init:init,};};;
var HappycowClickObserver=function(){function init(){const clickObservers=document.querySelectorAll("[data-click='observer']");for(let i=0;i<clickObservers.length;i++){clickObservers[i].addEventListener('click',clickEvent,true);}}
function clickEvent(event){const targetElement=event.target||event.srcElement;const type=getType(targetElement);if(!type){return;}
HappycowAnalytics.event(5,{name:type});}
function observe(type){HappycowAnalytics.event(5,{name:type});}
function getType(el){let type=el.dataset.observeType;if(type&&type.length>0){return type;}
type=el.parentElement.dataset.observeType;if(!type||type.length===0){return false;}
return type;}
return{initialize:init,observe:observe,};};;
var HappycowObserver=(function(){const facebookSection=document.querySelector('section.facebook');const footerSection=document.querySelector('footer.footer');const videoSection=document.querySelector('section.video-section');const images=document.querySelectorAll('.lazy-js-image');const loginFacebook=document.querySelector('.login-facebook');const loginGoogle=document.querySelector('.btn-google-register');const registerFacebook=document.querySelector('.register');const reviewThanks=document.querySelector('.review-thanks');const adsbyGoogle=document.querySelector('.adsbygoogle');const googleTags=document.querySelector('.hc-google-placement');const queue=[];const observers=[facebookSection,footerSection,videoSection,loginFacebook,loginGoogle,registerFacebook,reviewThanks,adsbyGoogle,googleTags];let io=null;let ioImage=null;function preloadImage(img){const background=img.getAttribute('data-background');if(background){img.style=`background-image: url('${background}');`;return;}
const src=img.getAttribute('data-src');if(!src){return;}
img.src=src;const srcset=img.getAttribute('data-srcset');if(!srcset){return;}
img.srcset=srcset;}
function handleIntersection(entry){if(entry.target.classList.contains('lazy-js-image')){preloadImage(entry.target);}else if(entry.target.classList.contains('carousel-item')){if(entry.intersectionRatio<1)return;const parent=entry.target.parentNode;const index=Array.prototype.indexOf.call(parent.children,entry.target);HappycowCarousel.setIndicators(entry.target.closest('.carousel'),index);return;}else if(entry.target===adsbyGoogle){HappycowAds.loadAdsense();}else if(entry.target===reviewThanks){HappycowSocial.loadFacebook();HappycowSocial.loadTwitter();}else if(entry.target===googleTags){HappycowAds.loadGoogleTags();}else if(entry.target===registerFacebook){HappycowSocial.loadFacebook();}else if(entry.target===loginFacebook){HappycowSocial.loadFacebook();}else if(entry.target===loginGoogle){initGoogle();}else if(entry.target.classList.contains('modal-gallery')||entry.target.classList.contains('gallery')){HappycowSocial.loadFacebook();}else if(entry.target===facebookSection){if(document.querySelector('.fb-page')){const template=`
                    <div class="fb-page" aria-hidden="true" data-href="https://www.facebook.com/HappyCow/?fref=ts" data-width="290" data-small-header="false" data-adapt-container-width="false" data-hide-cover="false" data-show-facepile="true">
                        <div class="fb-xfbml-parse-ignore">
                            <blockquote cite="https://www.facebook.com/HappyCow/?fref=ts">
                                <a href="https://www.facebook.com/HappyCow/?fref=ts" title="Go to the HappyCow Facebook page">HappyCow Vegan Guide</a>
                            </blockquote>
                        </div>
                    </div>
                `;appendContent('section.facebook',template);}
HappycowSocial.loadFacebook();if(window.fbAsyncInit){HappycowSocial.initAsyncFacebook();}}else if(entry.target==footerSection){HappycowSocial.loadGoogleSearch();}else if(entry.target==videoSection){HappycowSocial.loadYoutube();}else{dispatchCustomEvent(document.body,'intersection.visible',entry);}
io.unobserve(entry.target);}
function init(){io=new IntersectionObserver((entries)=>{entries.forEach((entry)=>{if(entry.intersectionRatio>0){handleIntersection(entry);}});},{threshold:[0,0.15,0.5,0.75,1],});clickObserver.initialize();queue.forEach((item)=>{io.observe(item);});images.forEach((image)=>{io.observe(image);});observers.forEach((observer)=>{if(observer){io.observe(observer);}});}
function observe(item){if(!item)return;if(!io){queue.push(item);return;}
io.observe(item);}
function preloadImageObserve(item){if(!ioImage){ioImage=new IntersectionObserver(function(entries){entries.forEach((entry)=>{if(entry.intersectionRatio==1){preloadImage(entry.target);ioImage.unobserve(entry.target);}});},{threshold:[1],});}
ioImage.observe(item);}
return{init:init,observe:observe,preloadImage:preloadImage,preloadImageObserve:preloadImageObserve,};})();;
var HappycowForm=(function(){let forms=null;function init(formSelector){forms=document.querySelectorAll(formSelector);if(forms.length==0)return;setInitialState();addLiveEventListener('submit',formSelector,()=>{setInitialState();});addLiveEventListener('reset',formSelector,()=>{setInitialState();});window.addEventListener('beforeunload',(e)=>{const hasChanges=formHasChanges();if(hasChanges){e.preventDefault();e.returnValue='You have unsaved changes!';return false;}
return false;});}
function setInitialState(){forms.forEach((form)=>{for(let i=0;i<form.length;i++){const el=form[i];if(el.id=='g-recaptcha-response')continue;el.dataset.origValue=el.value;}});}
function formHasChanges(){let changed=false;forms.forEach((form)=>{for(let i=0;i<form.length;i++){const el=form[i];if('origValue'in el.dataset&&el.dataset.origValue!==el.value){changed=true;}}});return changed;}
return{init:init,initialState:setInitialState,};})();;
var HappycowAnalytics=(function(){let socket=null;function init(){socket=new WebSocket(`wss://${window.location.hostname}/analytics_socket`);socket.onopen=function(e){};socket.onmessage=function(e){};socket.onclose=function(e){};socket.onerror=function(e){};}
function getPlatform(){const userAgent=navigator.userAgent||navigator.vendor||window.opera;if(/android/i.test(userAgent)){return 1;}
if(/iPad|iPhone|iPod/.test(userAgent)&&!window.MSStream){return 0;}
return 2;}
function triggerEvent(action,params={}){const packet={type:'event',action:action,platform:getPlatform(),params:params,};if(socket&&socket.readyState==1){socket.send(JSON.stringify(packet));}}
function gtagEvent(actionName,options){if(!gtag)return;if(options){gtag('event',actionName,options);return;}
gtag('event',actionName);}
function gtagSet(property,options={}){if(!gtag)return;if(property){gtag('set',property,options);return;}
gtag('set',options);}
function gtagEventLink(target,actionName,options){if(!gtag)return;if(options){addLiveEventListener('mousedown',target,(e)=>{if(e.button===0||e.button===1){HappycowAnalytics.gtagEvent(actionName,options);}});return;}
addLiveEventListener('mousedown',target,(e)=>{if(e.button===0||e.button===1){HappycowAnalytics.gtagEvent(actionName);}});}
function gtagEventCheck(selector,actionName,options){if(!selector||!document.querySelector(selector))return;if(options){HappycowAnalytics.gtagEvent(actionName,options);return;}
HappycowAnalytics.gtagEvent(actionName);}
return{init:init,event:triggerEvent,gtagEvent:gtagEvent,gtagSet:gtagSet,gtagEventLink:gtagEventLink,gtagEventCheck:gtagEventCheck,};})();;
var HappycowRegister=function(){let registerState=null;let registerForm=null;function init(form=null){if(!form){return;}
registerState={};registerForm=document.querySelector(form);}
function setState(){const fields=registerForm.querySelectorAll('input,select');for(const field of fields){if(field.tagName.toLowerCase()==='select'){registerState[field.name]=field.selectedOptions[0].value;}else if(field.name==='lat'&&!field.value){registerState.lat=0;}else if(field.name==='lng'&&!field.value){registerState.lng=0;}else if(field.type==='checkbox'){registerState[field.name]=field.checked?1:0;}else{registerState[field.name]=field.value;}}}
function getState(){return registerState;}
function clearState(){for(const prop of Object.keys(registerState)){delete registerState[prop];}}
function setItemValue(){const fields=registerForm.querySelectorAll('input, select');for(const field of fields){for(const prop of Object.keys(registerState)){if(field.tagName.toLowerCase()==='select'&&field.name==prop){field.value=registerState[prop];}else if(field.type==='checkbox'&&field.name===prop){field.checked=registerState[prop];}else if(field.name===prop){field.value=registerState[prop];}}}}
function getStateItem(key){return registerState[key];}
function register(token,container,modal=false){const formData=new FormData();HappycowAnalytics.gtagEvent('signup_submit');Object.keys(registerState).forEach((key)=>formData.append(key,registerState[key]));formData.append(csrf.name,csrf.value);formData.append('g-recaptcha-response',token);post('/ajax/register',formData).then((data)=>{if(data.success){if(data.redirect){window.location.href=data.redirect;return;}
emptyElement(container);appendContent(container,data.view);this.clearState();if(modal){document.querySelector('#authentication-modal').classList.remove('modal-register-step-2');document.querySelector('#authentication-modal').classList.add('modal-register-step-3');}
if(registerForm.getAttribute('data-is-social')==='1'){HappycowCommon.sendRegisterAnalytics('social');return;}
HappycowCommon.sendRegisterAnalytics('hc');return;}
HappycowToastr.error(data.message||'Something went wrong on our side. Please try again later or contact us.');}).catch((e)=>{HappycowToastr.error('Something went wrong on our side. Please try again later or contact us.');});}
return{init,setState,getState,clearState,setItemValue,getStateItem,register,};};;
var HappycowGoogleRecaptcha=(function(){function init(){if(document.querySelector('.g-recaptcha')){loadJs('https://www.recaptcha.net/recaptcha/api.js?hl=en&onload=recaptchaRender&render=explicit').then(()=>{document.body.setAttribute('data-recaptcha',true);});}}
function loadGoogleRecaptcha(alternativeRecaptcha=false){let url='https://www.recaptcha.net/recaptcha/api.js?hl=en&onload=recaptchaRender&render=explicit';if(alternativeRecaptcha){url='https://www.recaptcha.net/recaptcha/api.js?hl=en';}
if(!document.body.getAttribute('data-recaptcha')){loadJs(url).then(()=>{document.body.setAttribute('data-recaptcha',true);});}}
return{init,loadGoogleRecaptcha,};})();;
var auth=new HappycowAuthentication();var socialData={};(()=>{addLiveEventListener('shown.hc.modal','.modal-login',function(e){HappycowSidebar.hide();HappycowSocial.loadFacebook();});addLiveEventListener('shown.hc.registration','#authentication-modal .register-form-container',function(e){if(Object.keys(socialData).length==0)return;document.querySelector('#modal-register-email').value=socialData.email;document.querySelector('#modal-register-email').readOnly=true;document.querySelector('#modal-register-username').value=socialData.username.replace(/\s/g,'');if(socialData.fbid){document.querySelector('#modal-register-fbid').value=socialData.fbid;document.querySelector('#modal-register-googleid').value='';document.querySelector('#modal-register-appleid').value='';HappycowToastr.basic('Complete the form to register with Facebook');}else if(socialData.googleid){document.querySelector('#modal-register-fbid').value='';document.querySelector('#modal-register-appleid').value='';document.querySelector('#modal-register-googleid').value=socialData.googleid;HappycowToastr.basic('Complete the form to register with Google');}else if(socialData.appleid){document.querySelector('#modal-register-fbid').value='';document.querySelector('#modal-register-appleid').value=socialData.appleid;document.querySelector('#modal-register-googleid').value='';HappycowToastr.basic('Complete the form to register with Apple');}
socialData={};});if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){document.querySelector('meta[name=viewport]').setAttribute('content','initial-scale=1.0000, minimum-scale=1.0000, maximum-scale=1.0000, user-scalable=no');}
addLiveEventListener('click','.btn-apple-register',function(e){e.preventDefault();HappycowCommon.initAppleApi().then(function(){AppleID.auth.signIn().then((data)=>{auth.appleLogin(data.authorization.id_token).then(function(d){handleResponse(d,'ap');}).catch(function(error){showError(error,'Something went wrong with Apple Authentication, please try again soon');});});}).catch(function(rrore){showError(error);});});addLiveEventListener('click','#fb-login, #fb-register',function(e){e.preventDefault();const options={scope:'public_profile,email,user_hometown',return_scopes:true,};loginFacebook(options);});function loginFacebook(options){if(typeof FB==='undefined')return;FB.login(function(response){FB.api('/me/permissions',function(permissionsResponse){const declined=[];if(!permissionsResponse.data)return;for(i=0;i<permissionsResponse.data.length;i++){if(permissionsResponse.data[i].status=='declined'){declined.push(permissionsResponse.data[i].permission);}}
if(response.status==='connected'&&declined.indexOf('email')!==-1){HappycowAlert.alert({title:'Facebook Registration failed',message:"It seems you haven't allowed your email to be shared. We require this to set up your account. Please try again.",buttons:{cancel:false,extra:{text:'Request Email Permission',closeModal:true,value:'requestEmailPermission',},confirm:{closeModal:true,},},}).then(function(value){if(value&&value==='requestEmailPermission'){options.scope='email';options.auth_type='rerequest';loginFacebook(options);}});return false;}
auth.facebookLogin().then(function(d){handleResponse(d,'fb');}).catch(function(error){showError(error,'Something went wrong with Facebook Authentication, please try again soon');});});},options);}
addLiveEventListener('click','#login-form [type=submit]',function(e){e.preventDefault();const loginForm=document.querySelector('#login-form');if(!loginForm)return;HappycowAnalytics.gtagEvent('login_submit');HappycowValidator.check(loginForm,false,true).then((result)=>{if(!result){return;}
const username=loginForm.querySelector('#dialog-username').value;const password=loginForm.querySelector('#password').value;const remember=loginForm.querySelector('#remember').checked;auth.login(username,password,remember).then(function(d){handleResponse(d);}).catch(function(error){showError(error);loginForm.querySelector('.dialog-username').focus();});}).catch((error)=>{HappycowToastr.error('Something went wrong. Please try again later or contact us.');});});})();function initGoogle(){HappycowCommon.initGoogleApi().then(function(){const els=document.querySelectorAll('.btn-google-register');els.forEach(function(item){if(item){auth2.attachClickHandler(item,{},function(googleUser){const token=googleUser.getAuthResponse().id_token;auth.googleLogin(token).then(function(d){handleResponse(d,'gg');});},function(error){showError(error,'Something went wrong with Google Authentication, please try again soon');});}});});}
function handleResponse(d,method='hc'){if(d.success){const authenticationModal=document.querySelector('#authentication-modal');if(authenticationModal){const loginForm=authenticationModal.querySelector('form#login-form');if(loginForm)loginForm.reset();}
HappycowCommon.sendLoginAnalytics(method);const registerPage=document.querySelector('#members-register');if(registerPage){const registerForm=registerPage.querySelector('#register-form');if(registerForm)registerForm.reset();}
const loginPage=document.querySelector('#members-login');if(loginPage){if(d.returnTo&&d.returnTo.length>0){window.location=d.returnTo;return;}}
if(d.firstLogin){window.location='/members/profile/edit';return;}
if(registerPage){window.location.href='/';return;}
if(authenticationModal){HappycowModal.close('#authentication-modal');getUserData();const personalDetails=document.querySelector('.personal-details');if(personalDetails){personalDetails.remove();}
HappycowToastr.success('You are now logged in');return;}
window.location.href='/';return;}
if(d.message&&Object.keys(d.message).length>0){if(d.message.fbid||d.message.googleid||d.message.appleid){handleSocialRegistration(d.message);return;}}
if(d.message&&d.message.length>0){HappycowToastr.error(d.message);const loginForm=document.querySelector('#login-form');if(loginForm){loginForm.querySelector('#password').value='';loginForm.querySelector('#dialog-username').focus();}}}
function handleSocialRegistration(data){const authenticationModal=document.querySelector('#authentication-modal');if(authenticationModal&&authenticationModal.classList.contains('show')){document.querySelector('.nav-item-register a').click();socialData=data;return;}
const registerPage=document.querySelector('#members-register');if(registerPage){document.querySelector('#register-form #email').value=data.email;document.querySelector('#register-form #email').readOnly=true;document.querySelector('#register-form #username').value=data.username.replace(/\s/g,'');if(data.fbid){document.querySelector('#register-form #fbid').value=data.fbid;document.querySelector('#register-form #googleid').value='';document.querySelector('#register-form #appleid').value='';HappycowToastr.basic('Complete the form to register with Facebook');return true;}
if(data.googleid){document.querySelector('#register-form #fbid').value='';document.querySelector('#register-form #googleid').value=data.googleid;document.querySelector('#register-form #appleid').value='';HappycowToastr.basic('Complete the form to register with Google');return true;}
if(data.appleid){document.querySelector('#register-form #fbid').value='';document.querySelector('#register-form #googleid').value='';document.querySelector('#register-form #appleid').value=data.appleid;HappycowToastr.basic('Complete the form to register with Apple');return true;}}};
var csrf=HappycowCommon.csrf();var pubSub=new HappycowPubSub();var clickObserver=new HappycowClickObserver();HappycowValidator.init();HappycowModal.init();HappycowCarousel.init();HappycowDropdown.init('body','[data-dropdown="toggle"]');HappycowGoogleRecaptcha.init();window.onload=()=>{setTimeout(()=>{const parsedContent=new DOMParser().parseFromString(document.querySelector('#deferred-scripts').textContent,'text/html');const deferredScripts=parsedContent.querySelectorAll('script');deferredScripts.forEach((item)=>{loadJs(item.getAttribute('src'));});},50);};function recaptchaRender(){const recaptchaAuth=document.querySelector('.g-recaptcha-authentication');if(recaptchaAuth){grecaptcha.render(recaptchaAuth.id,{sitekey:recaptchaAuth.dataset.sitekey,callback:recaptchaAuth.dataset.callback,});}
const recaptchaItems=document.querySelectorAll('.g-recaptcha');recaptchaItems.forEach(function(item){grecaptcha.render(item.id,{sitekey:item.dataset.sitekey,callback:item.dataset.callback,});});};